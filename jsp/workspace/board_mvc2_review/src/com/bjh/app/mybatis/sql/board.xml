<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http//mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Board">
	<!-- 총 게시글 수 -->
	<select id="boardCnt" resultType="_int">
		SELECT COUNT(*) FROM TABLE_BOARD
	</select>

	<!-- 한 페이지에 뿌려 줄 게시글 10개 -->
	<select id="listAll" parameterType="hashmap" resultType="boardVO">
		SELECT * FROM
			(SELECT ROWNUM R, D.* FROM
				(SELECT * FROM TABLE_BOARD ORDER BY BOARDNUM DESC) D) B
		WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<!-- 조회수 -->
	<update id="updateReadCount" parameterType="_int">
		UPDATE TABLE_BOARD SET READCOUNT = READCOUNT + 1 WHERE BOARDNUM = #{boardNum}
	</update>
	
	<!-- 게시글 등록 -->
	<insert id="insertBoard" parameterType="boardVO">
		INSERT INTO TABLE_BOARD VALUES(BOARD_SEQ.NEXTVAL, #{boardTitle}, #{boardContent}, #{boardId}, sysdate, 0)
	</insert>
	
	<!-- 현재 시퀀스 가져오기 -->
	<select id="getBoardNum" resultType="_int">
		SELECT BOARD_SEQ.CURRVAL FROM DUAL
	</select>
	
	<!-- 게시글 상세보기 -->
	<select id="getDetail" parameterType="_int" resultType="boardVO">
		SELECT * FROM TABLE_BOARD WHERE BOARDNUM = #{boardNum}
	</select>
	
	<!-- 게시글 삭제하기 -->
	<delete id="deleteBoard" parameterType="_int">
		DELETE TABLE_BOARD WHERE BOARDNUM = #{boardNum}
	</delete>
	
	<!-- 게시글 수정하기 -->
	<update id="updateBoard" parameterType="boardVO">
		UPDATE TABLE_BOARD SET BOARDTITLE = #{boardTitle}, BOARDCONTENT = #{boardContent} WHERE BOARDNUM = #{boardNum}
	</update>
	
	<!-- 댓글 부분 -->
	<!-- 댓글 불러오기 -->
	<select id="replyList" parameterType="_int" resultType="boardReplyVO">
		SELECT * FROM TABLE_REPLY WHERE BOARDNUM = #{boardNum}
	</select>
	
	<!-- 댓글 추가하기 -->
	<insert id="insertReply" parameterType="boardReplyVO">
		INSERT INTO TABLE_REPLY VALUES(REPLY_SEQ.NEXTVAL, #{boardNum}, #{memberId}, #{replyContent})
	</insert>
	
	<!-- 댓글 삭제하기 -->
	<delete id="deleteReply" parameterType="_int">
		DELETE TABLE_REPLY WHERE REPLYNUM = #{replyNum}
	</delete>
	
	<!-- 댓글 수정하기 -->
	<update id="updateReply" parameterType="boardReplyVO">
		UPDATE TABLE_REPLY SET REPLYCONTENT = #{replyContent} WHERE REPLYNUM = #{replyNum}
	</update>
</mapper>